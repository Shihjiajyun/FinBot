# FinBot 批量股票處理系統

## 📋 概述

本系統提供三個主要腳本，用於批量下載和處理美國股票的10-K財報：

1. **ALL.py** - 批量下載股票10-K財報
2. **ALL_2.py** - 批量拆解10-K財報ITEM內容
3. **run_all.py** - 一鍵執行完整流程

## 🚀 主要功能特色

### ✨ 智能排除重複下載
- 自動檢查 `downloads` 資料夾中已下載的股票
- 只下載尚未下載的股票，避免重複作業
- 已自動排除 AAPL 股票

### 📈 大幅擴展股票清單
- **500+ 股票代號**，包含：
  - S&P 500 成分股
  - Russell 1000 主要股票
  - 科技巨頭 (FAANG+)
  - 生技醫療股
  - 金融保險股
  - 能源公用事業
  - 新興成長股 (EV、綠能等)
  - 國際 ADR

### 🔍 智能ITEM拆解
- 自動檢查哪些股票需要拆解
- 只處理新下載或未拆解的股票
- 將拆解結果存入 `ten_k_filings` 資料表

## 📁 文件結構

```
FinBot/
├── ALL.py              # 股票下載腳本
├── ALL_2.py            # ITEM拆解腳本
├── run_all.py          # 一鍵執行腳本
├── downloads/          # 下載的財報存放處
│   ├── MSFT/
│   │   └── 10-K/
│   ├── GOOGL/
│   └── ...
└── README_BATCH.md     # 說明文檔
```

## 🎯 使用方法

### 方法一：一鍵執行 (推薦)

```bash
python run_all.py
```

這會自動依序執行：
1. 下載新股票的10-K財報
2. 拆解新下載股票的ITEM內容

### 方法二：分步執行

#### 1. 下載股票財報

```bash
# 查看股票清單狀態
python ALL.py --list

# 下載所有尚未下載的股票
python ALL.py

# 下載特定範圍的股票 (第1-50家)
python ALL.py --range 0 50

# 查看幫助
python ALL.py --help
```

#### 2. 拆解ITEM內容

```bash
# 拆解所有尚未拆解的股票
python ALL_2.py
```

## 📊 執行流程說明

### ALL.py 執行流程

1. **掃描已下載股票**
   - 檢查 `downloads/*/10-K/*.txt` 檔案
   - 建立已下載股票清單

2. **過濾需下載股票**
   - 從完整股票清單中排除已下載的
   - 顯示需要下載的股票數量

3. **批量下載**
   - 每家公司間隔3秒，避免API限制
   - 每10家公司輸出進度統計
   - 支援中途中斷 (Ctrl+C)

### ALL_2.py 執行流程

1. **檢查拆解狀態**
   - 查詢資料庫中已拆解的股票
   - 找出需要拆解的股票清單

2. **智能ITEM拆解**
   - 清理HTML標籤和CSS樣式
   - 自動定位真實內容開始位置
   - 拆解16個ITEM + 附錄內容

3. **存入資料庫**
   - 防重複機制 (content_hash)
   - 完整的元數據記錄

## 🔧 配置說明

### 資料庫配置 (ALL_2.py)

```python
db_config = {
    'host': '43.207.210.147',
    'database': 'finbot_db', 
    'user': 'myuser',
    'password': '123456789',
    'charset': 'utf8mb4'
}
```

### 股票清單
- 總計 500+ 股票代號
- 自動排除 AAPL
- 涵蓋各主要行業類別

## 📈 執行統計範例

### 下載統計
```
🏁 批量10-K下載完成報告
================================================================================
📊 總計處理: 50 家公司
✅ 下載成功: 45 家 (90.0%)
❌ 下載失敗: 5 家 (10.0%)
⏱️ 總耗時: 25.3 分鐘
⚡ 平均每家: 30.4 秒
```

### 拆解統計
```
🎉 批量10-K拆解完成!
================================================================================
📊 拆解統計:
   ✅ 成功拆解股票: 42 家
   ❌ 拆解失敗股票: 3 家  
   📄 總拆解檔案數: 210 個
⏱️ 總耗時: 15.2 分鐘
⚡ 平均每股票: 21.6 秒
```

## ⚠️ 注意事項

1. **網路穩定性**
   - 確保網路連線穩定
   - SEC API有速率限制

2. **磁碟空間**
   - 每個10-K檔案約1-5MB
   - 500家公司約需2-10GB空間

3. **執行時間**
   - 完整下載可能需要2-4小時
   - 拆解處理約需30分鐘-1小時

4. **中斷恢復**
   - 支援中途中斷，下次執行會自動跳過已完成的部分
   - 不會重複下載或拆解

## 🔍 故障排除

### 常見問題

1. **網路連線問題**
   ```
   ❌ download_single_stock.py 失敗: 連線逾時
   ```
   - 解決：檢查網路連線，稍後重試

2. **資料庫連線問題**
   ```
   ❌ 資料庫連接失敗: Access denied
   ```
   - 解決：檢查資料庫配置和權限

3. **檔案權限問題**
   ```
   ❌ 找不到 downloads 資料夾
   ```
   - 解決：確認執行權限和路徑

### 日誌檔案
- `batch_processor.log` - 下載日誌
- 主控台輸出包含詳細進度資訊

## 📞 技術支援

如有問題，請檢查：
1. 日誌檔案內容
2. 網路連線狀態  
3. 資料庫連線設定
4. 執行路徑和權限

---

**更新日期**: 2025年12月
**版本**: v2.0 - 智能批量處理版 