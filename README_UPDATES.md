# FinBot 更新說明

## 📈 新功能實現

### 1. Markdown 語法支持
- **問答回答支持完整Markdown渲染**
- 支持標題、粗體、斜體、項目列表、代碼塊、表格等
- 優化深色主題下的顯示效果
- 支持程式碼語法高亮

### 2. 圖表數據視覺化
- **GPT可以返回圖表數據，前端自動渲染**
- 支持線圖、柱狀圖、圓餅圖、面積圖
- 使用Chart.js庫進行圖表渲染
- 深色主題適配的圖表樣式
- 響應式圖表設計

#### 圖表數據格式
GPT可以在回答中加入以下格式的圖表數據：
```chart
{
  "type": "line",
  "title": "營收趨勢圖",
  "data": {
    "labels": ["2021", "2022", "2023"],
    "datasets": [{
      "label": "營收（百萬美元）",
      "data": [1000, 1200, 1300],
      "backgroundColor": "rgba(54, 162, 235, 0.2)",
      "borderColor": "rgba(54, 162, 235, 1)"
    }]
  }
}
```

### 3. 左側邊欄改進
- **移除"新對話"按鈕**
- **改為股票查詢歷史記錄**
- 點擊歷史記錄直接進入該股票的查詢頁面
- 使用localStorage保存查詢歷史
- 最多保存20筆查詢記錄

#### 新的工作流程
1. 用戶點擊「股票查詢」
2. 輸入股票代號並查詢
3. 系統自動記錄到左側歷史
4. 用戶可以點擊歷史記錄快速重新查詢
5. 在股票頁面可以直接進行問答

### 4. 技術改進
- **優化了Markdown渲染器整合**
- **加入Chart.js圖表庫**
- **改進了股票查詢歷史管理**
- **統一了用戶界面流程**

## 🔧 修改的文件

### 1. `index.php`
- 添加Chart.js庫引用
- 移除"新對話"按鈕
- 更新側邊欄註釋

### 2. `stock_qa_api.php`
- 更新GPT prompt支持Markdown和圖表
- 加入圖表數據格式說明

### 3. `js/stock-query.js`
- 新增圖表數據處理函數
- 改進Markdown渲染
- 新增股票查詢歷史功能
- 加入localStorage管理

### 4. `js/chat.js`
- 修改loadConversations改為載入股票歷史
- 簡化startNewChat函數

### 5. `css/index.css`
- 新增圖表容器樣式
- 改進Markdown內容樣式
- 加入響應式圖表支持

## 🎯 使用方式

### 用戶操作流程
1. 登入系統
2. 點擊「股票查詢」
3. 輸入股票代號（如：AAPL、TSLA）
4. 查看股票基本資訊和財務數據
5. 在問答區塊提出問題
6. 獲得支持Markdown和圖表的專業回答

### GPT 回答示例
GPT現在可以提供以下格式的回答：

**基本Markdown回答：**
```markdown
## Apple (AAPL) 財務分析

根據**Item 7 管理層討論與分析**，Apple 2023年的表現如下：

### 主要財務指標
- **總營收**: $383.29 billion
- **淨利潤**: $96.99 billion  
- **毛利率**: 44.1%

### 趨勢分析
1. 營收同比增長 2.8%
2. iPhone業務仍為主要收入來源
3. 服務業務持續成長
```

**帶圖表的回答：**
```markdown
## Apple 營收趨勢分析

根據財務數據，以下是Apple近三年的營收表現：

```chart
{
  "type": "line",
  "title": "Apple 營收趨勢 (2021-2023)",
  "data": {
    "labels": ["2021", "2022", "2023"],
    "datasets": [{
      "label": "營收（十億美元）",
      "data": [365.8, 394.3, 383.3],
      "borderColor": "rgba(54, 162, 235, 1)",
      "backgroundColor": "rgba(54, 162, 235, 0.2)"
    }]
  }
}
```

## 📝 注意事項

1. **圖表庫依賴**: 需要網路連線載入Chart.js
2. **瀏覽器支援**: 建議使用現代瀏覽器
3. **數據來源**: 圖表數據基於10-K報告摘要
4. **歷史記錄**: 存儲在瀏覽器localStorage中

## 🚀 後續規劃

- [ ] 支援更多圖表類型
- [ ] 加入圖表匯出功能
- [ ] 改進Markdown樣式
- [ ] 加入搜尋功能到歷史記錄 